#!/usr/bin/env bash
set -euo pipefail

CHOICES=(Shutdown Reboot Cancel)
PROMPT="Power"

if command -v fuzzel >/dev/null 2>&1; then
    MENU_CMD=(fuzzel --dmenu --prompt="$PROMPT" --width=20 --lines=3)
elif command -v wofi >/dev/null 2>&1; then
    MENU_CMD=(wofi --dmenu --prompt "$PROMPT")
elif command -v rofi >/dev/null 2>&1; then
    MENU_CMD=(rofi -dmenu -p "$PROMPT")
elif command -v bemenu >/dev/null 2>&1; then
    MENU_CMD=(bemenu -p "$PROMPT")
elif command -v dmenu >/dev/null 2>&1; then
    MENU_CMD=(dmenu -p "$PROMPT")
else
    notify-send "$PROMPT" "No menu launcher (fuzzel/wofi/rofi/bemenu/dmenu) found" >/dev/null 2>&1 || true
    exit 1
fi

SELECTION=$(printf '%s\n' "${CHOICES[@]}" | "${MENU_CMD[@]}" || true)

case "$SELECTION" in
    Shutdown)
        systemctl poweroff
        ;;
    Reboot)
        systemctl reboot
        ;;
    *)
        exit 0
        ;;
esac
